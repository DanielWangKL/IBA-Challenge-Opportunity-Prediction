---
title: "IBA_Evaluation"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#just use download.packages() function to download the package if you not already have one
library(ggplot2)
library(tidyverse)
library(lubridate)
```

##load the data
```{r}
opportunities_table = as_tibble(read.csv("opportunities_table_v1.csv", header = TRUE))
#opportunity_background_required_table = as_tibble(read.csv("opportunity_background_required_table_v1.csv", header = TRUE))
#opportunity_language_required_table = as_tibble(read.csv("opportunity_language_required_table_v1.csv", header = TRUE))
#opportunity_skill_required_table = as_tibble(read.csv("opportunity_skill_required_table_v1.csv", header = TRUE))
#opportunity_background_preference_table = as_tibble(read.csv("opportunity_background_preference_table_v1.csv", header = TRUE))
#opportunity_language_preference_table = as_tibble(read.csv("opportunity_language_preference_table_v1.csv", header = TRUE))
#opportunity_skill_preference_table = as_tibble(read.csv("opportunity_skill_preference_table_v1.csv", header = TRUE))
app = as_tibble(read.csv("opportunity_applications_iba_challenge.csv", header = TRUE))
#lda = as.tibble(read.csv("lda_iba_challenge_team_11.csv", header = TRUE))
#lda_realised = as.tibble(read.csv("cleaned_lda.csv", header = TRUE))
```


## data transformation
```{r}
##change all applications null values in "interviewed" to false
levels(app$interviewed)[1] <- levels(app$interviewed)[2]
head(opportunities_table)
```


##Evaluate the difference between status and an_status for application table
```{r}
str(app)
head(app)
```

```{r}
##overview of both status and an_status
app %>% group_by(status) %>% count %>% arrange(desc(n))
app %>% group_by(an_status) %>% count %>% arrange(desc(n))
##comments on an_status: This should be the acceptance offer issued by the employers and 416112 offer letters are issued.
```

```{r}
##status "open"
app %>% filter(status == "open") %>% group_by(interviewed, an_status) %>% count
##comments: There are 1659160 applications which has status "open" and most of them are not interviewed. Only 2856 are interviewed. Also, all of them have empty values in the column "experience_start_date" which can be concluded that if the status is open, it's a unifinished application or the employers never interact with that application.
```

```{r}
##status "withdrawn"
app %>% filter(status == "withdrawn") %>% group_by(an_status) %>% count
app %>% filter(status == "withdrawn") %>% group_by(experience_start_date) %>% count
app %>% filter(status == "withdrawn", an_status == "accepted") ##this is for evaluting the offer withdrawn but offer letter issued
app %>% filter(status == "withdrawn", experience_start_date != "") ##this is for evaulating the offer accepted but withdrawn cases
##comments: This means the applicant withdraws from the application. This can happen both before or after offer letter issued
```

```{r}
##status "rejected"
app %>% filter(status == "rejected") %>% group_by(an_status) %>% count
app %>% filter(status == "rejected", an_status == "accepted")
#app %>% filter(status == "rejected") %>% mutate(decision = is.na(matched_or_rejected_at)) %>% group_by(decision) %>% count
##comments: Assume the company rejects the candidate. The company can reject the candidate after issuing offer letters
```

##Evaluate the opportunities for advertisements (Q1)
```{r}
opportunities_table$month_created <- as.Date(opportunities_table$month_created)
opportunities_table$year_created <- as.Date(opportunities_table$year_created)
str(opportunities_table)
##opportunities by month by programmes
opportunities_table %>% group_by(programme_id, month_created) %>% count %>% ggplot(aes(x=month_created, y = n, colour = programme_id)) + geom_line(aes(group = programme_id))
##Observations
##The number of "Global Volunteer" and "Global Entrepreneur" increases significantly.
##The number of "Global Talent" keeps at a moderate pace.
##comments
##We can partner with more startups for more opportunities in "Global Entrepreneur"" programme as we can see there is a upward trend starting from 2015.
##We can keep explore opportunities in "Global Volunteer".
```

```{r}
##opportunities of global volunteer by region from 2012 to 2018
opportunities_table %>% filter(programme_id == "Global Volunteer", month_created > "2012-01-01") %>% group_by(name_region, month_created) %>% count %>% ggplot(aes(x = month_created, y = n, color = name_region)) + geom_line(aes(group = name_region))

```

```{r}
##opportunities by region from 2012 to 2019
opportunities_table %>% filter(month_created > "2012-01-01") %>% group_by(name_region, month_created) %>% count %>% ggplot(aes(x = month_created, y = n, color = name_region)) + geom_line(aes(group = name_region)) + ggtitle("opportunities by region from 2012 to 2019")
##Observations
##Middle East and Africa and Asia Pacific contribute a significant amount in the increase of the opportunities
##There is a trend that opportunities will usually peak after the start of the year and after the mid-year.
##Comments
##We can keep explore the opportunities in Asia Pacific and Middle East and Africa
##Find some qualitative factors of what contribute to this trend in these two regions
```

```{r}
##applications by countries they apply for from 2012 to 2019
app %>% left_join(opportunities_table, by = "opportunity_id") %>% group_by(name_region, month_created) %>% count %>% filter(month_created > "2012-01-01") %>% ggplot(aes(x = month_created, y = n, color = name_region)) + geom_line(aes(group = name_region)) + ggtitle("applications by countries they apply for from 2012 to 2019")
##observations: most people apply for Europe opportunities
```

```{r}
#opportunities by programmes by region
opportunities_table %>% group_by(programme_id, name_region) %>% ggplot(aes(programme_id)) + geom_bar(aes(fill = name_region))
opportunities_table %>% group_by(programme_id, name_region) %>% ggplot(aes(programme_id)) + geom_bar(aes(fill = name_region)) + coord_polar("y", start=0)
head(app)

```

## Exploratory Data Analysis
```{r}
head(opportunities_table)
```
##oppportunity by programme_id
```{r}
opportunities_table %>% group_by(programme_id) %>% count %>% ggplot(aes(x = programme_id, y = n, fill = programme_id, label = n)) + geom_bar(stat = "identity") + geom_text(size = 3, position = position_stack(vjust = 0.5)) 
```
##oppportunity by openings
```{r}
opportunities_table %>% group_by(openings) %>% count %>% ggplot(aes(x = openings, y = n, label = n)) + geom_bar(stat = "identity") + xlim(0,500) + ylim(0,1000)
```
##oppportunity by duration_min
```{r}
opportunities_table %>% group_by(duration_min) %>% count
opportunities_table %>% group_by(duration_min) %>% count %>% ggplot(aes(x = duration_min, y = n, fill = duration_min, label = n)) + geom_bar(stat = "identity") + ylim(0,50000)
```
##oppportunity by name_region
```{r}
opportunities_table %>% group_by(name_region) %>% count
opportunities_table %>% group_by(name_region) %>% count %>% ggplot(aes(x = name_region, y = n, fill = name_region, label = n)) + geom_bar(stat = "identity") + geom_text(size = 3, position = position_stack(vjust = 0.5))
```
##oppportunity by name_entity
```{r}
opportunities_table %>% group_by(name_entity) %>% count %>% arrange(desc(n))
opportunities_table %>% group_by(name_entity) %>% count %>% ungroup %>% mutate(name_entity = reorder(name_entity, desc(n))) %>%ggplot(aes(x = name_entity, y = n, fill = name_entity, label = n)) + geom_bar(stat = "identity") + theme(legend.position = "none") + ylim(0,30000)
```

##oppportunity by favourites_count
```{r}
opportunities_table %>% group_by(favourites_count) %>% count %>% arrange(desc(n))
opportunities_table %>% group_by(favourites_count) %>% count %>% ungroup %>% mutate(favourites_count = reorder(favourites_count, desc(n))) %>%ggplot(aes(x = favourites_count, y = n, fill = favourites_count, label = n)) + geom_bar(stat = "identity") + theme(legend.position = "none") + ylim(0,25000)
```
##oppportunity by opportunity_applications_count
```{r}
opportunities_table %>% group_by(opportunity_applications_count) %>% count %>% arrange(desc(n))
opportunities_table %>% group_by(opportunity_applications_count) %>% count %>% ungroup %>% mutate(opportunity_applications_count = reorder(opportunity_applications_count, desc(n))) %>%ggplot(aes(x = opportunity_applications_count, y = n, fill = opportunity_applications_count, label = n)) + geom_bar(stat = "identity") + theme(legend.position = "none") + ylim(0,15000)
```
##oppportunity by status
```{r}
opportunities_table %>% group_by(status) %>% count %>% arrange(desc(n))
opportunities_table %>% group_by(status) %>% count %>% ungroup %>% mutate(status = reorder(status, desc(n))) %>%ggplot(aes(x = status, y = n, fill = status, label = n)) + geom_bar(stat = "identity") + geom_text(size = 3, position = position_stack(vjust = 0.5)) + theme(legend.position = "none")
```

##Realised opportunities (Q2)
```{r}
##realized rate by year
opportunities_table %>% group_by(realized, year_created) %>% count %>% spread(realized, n) %>% rename(Realized = "TRUE") %>%  rename(Not_realized = "FALSE") %>% mutate(sum = (Not_realized + Realized), Not_realized_rate = Not_realized/sum, Realized_rate = Realized/sum) %>% ggplot(aes(x = year_created, y = Realized_rate)) + geom_line()
##observation: The realization rate dropped in 2008 and started rising from then.
```

```{r}
##realized rate by programme
opportunities_table %>% group_by(programme_id,realized) %>% count %>% spread(realized, n) %>% rename(Realized = "TRUE") %>%  rename(Not_realized = "FALSE") %>% mutate(sum = (Not_realized + Realized), Not_realized_rate = Not_realized/sum, Realized_rate = Realized/sum)

##realized rate by programme by year
opportunities_table %>% group_by(programme_id,realized, year_created) %>% count %>% spread(realized, n) %>% rename(Realized = "TRUE") %>%  rename(Not_realized = "FALSE") %>% mutate(sum = (Not_realized + Realized), Not_realized_rate = Not_realized/sum, Realized_rate = Realized/sum) %>% ggplot(aes(x = year_created, y = Realized_rate, colour = programme_id)) + geom_line()
##comments: global volunteer has the highest realized rate followed by global talent and entreprenuer
```

```{r}
##realized rate by region
opportunities_table %>% group_by(name_region,realized, year_created) %>% count %>% spread(realized, n) %>% rename(Realized = "TRUE") %>%  rename(Not_realized = "FALSE") %>% mutate(sum = (Not_realized + Realized), Not_realized_rate = Not_realized/sum, Realized_rate = Realized/sum)

##realized rate by region by year
opportunities_table %>% group_by(name_region,realized, year_created) %>% count %>% spread(realized, n) %>% rename(Realized = "TRUE") %>%  rename(Not_realized = "FALSE") %>% mutate(sum = (Not_realized + Realized), Not_realized_rate = Not_realized/sum, Realized_rate = Realized/sum) %>% ggplot(aes(x = year_created, y = Realized_rate, colour = name_region)) + geom_line()
##observation: Realization rate across regions follow similar trends and seasonality.
```


